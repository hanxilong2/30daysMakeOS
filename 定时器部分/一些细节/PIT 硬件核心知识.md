---

### **PIT 硬件核心知识**

#### **1. PIT 基本特性**
- **物理芯片**：Intel 8254（x86 传统架构）
- **主要功能**：通过可编程计数器生成 **周期性中断** 或 **精确时间间隔**
- **组成**：
  - **3 个独立通道**（Channel 0/1/2）
  - **16 位计数器**（每个通道独立）
  - **时钟输入频率**：1.193182 MHz（经典值）

---

#### **2. PIT 控制字格式**
向 **控制寄存器（0x43）** 写入 1 字节配置：
$$
\text{控制字} = \underbrace{00}_{\text{通道0}} \underbrace{11}_{\text{先低后高}} \underbrace{010}_{\text{模式2}} \underbrace{0}_{\text{二进制计数}}
$$

- **通道选择**：
  - `00`: Channel 0（通常用于系统定时）
  - `01`: Channel 1（传统 DRAM 刷新，已废弃）
  - `10`: Channel 2（PC 扬声器）
- **读写模式**：
  - `11`: 先写低字节，再写高字节
- **工作模式**：
  - `010`: 模式2（速率发生器）
  - `011`: 模式3（方波发生器）
- **计数格式**：
  - `0`: 16 位二进制数
  - `1`: 4 位 BCD 码（极少使用）

---

#### **3. 中断频率计算**
$$
\text{中断频率} = \frac{\text{输入时钟频率}}{\text{计数值}} = \frac{1.193182\,\text{MHz}}{N}
$$

$$
N = \frac{1.193182 \times 10^6}{100} \approx 11932 \quad \Rightarrow \quad \text{十六进制} = 0x2E9C
$$

---

#### **4. PIT 初始化代码解析**
```c
// 设置 PIT 为模式2（速率发生器）
io_out8(PIT_CTRL, 0x34); // 控制字: 00_11_010_0

// 写入计数值 11932 (0x2E9C)
io_out8(PIT_CNT0, 0x9C); // 低字节
io_out8(PIT_CNT0, 0x2E); // 高字节
```

**操作时序**：
1. 写入控制字 `0x34` 到端口 `0x43`
2. 写入低字节 `0x9C` 到端口 `0x40`（Channel 0）
3. 写入高字节 `0x2E` 到端口 `0x40`

---

#### **5. 工作模式对比**
| 模式 | 名称       | 输出波形      | 典型应用             |
| ---- | ---------- | ------------- | -------------------- |
| 2    | 速率发生器 | 周期性低脉冲  | 系统时钟中断（IRQ0） |
| 3    | 方波发生器 | 50%占空比方波 | 蜂鸣器音调生成       |
| 0    | 中断触发   | 单次低电平    | 硬件超时检测         |

---

#### 6. 物理引脚连接（x86）
$$
\text{PIT Channel 0} \xrightarrow{\text{IRQ0}} \text{PIC} \xrightarrow{\text{INT 0x20}} \text{CPU}
$$

---

#### **7. 现代演变**
- **替代方案**：  
  - APIC Timer（多核 CPU 本地定时器）
  - HPET（高精度事件定时器）
- **兼容保留**：  
  PIT 仍存在于大多数 x86 系统以实现向后兼容。

